<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Dashboard â€“ CapTcha Tool</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    body { font-family: 'Inter', sans-serif; }
    .glass { backdrop-filter: blur(12px); background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.1); }
  </style>
</head>
<body class="bg-gradient-to-br from-gray-900 via-indigo-950 to-purple-950 text-gray-100 min-h-screen" x-data="dashboard()" x-init="init()">

<header class="fixed top-0 w-full glass border-b border-white/10 z-50">
  <nav class="max-w-6xl mx-auto px-4 py-4 flex justify-between items-center">
    <a href="index.html" class="flex items-center space-x-2">
      <div class="w-10 h-10 bg-gradient-to-r from-indigo-500 to-purple-600 rounded-lg flex justify-center items-center font-bold">CT</div>
      <span class="text-xl font-bold">CapTcha Tool</span>
    </a>
    <div class="flex items-center gap-3" x-show="user.email">
      <span class="text-sm" x-text="user.email"></span>
      <button @click="logout()" class="text-red-400 hover:text-red-300 transition">
        <i class="fas fa-sign-out-alt mr-1"></i>Logout
      </button>
    </div>
  </nav>
</header>

<main class="pt-24 pb-12 max-w-6xl mx-auto px-4 text-center">
  <template x-if="loading">
    <div class="py-24">
      <div class="animate-spin h-12 w-12 mx-auto border-4 border-indigo-500 border-t-transparent rounded-full mb-4"></div>
      <p>Loading your dashboard...</p>
    </div>
  </template>

  <template x-if="!loading && user.email">
    <div>
      <h1 class="text-3xl font-bold mb-4">Welcome, <span x-text="user.email"></span></h1>
      <p class="text-gray-400 mb-8">Your account is securely authenticated with Firebase.</p>
      <canvas id="chart" height="100"></canvas>
    </div>
  </template>

  <template x-if="error">
    <div class="py-24 text-red-400">
      <i class="fas fa-exclamation-triangle text-4xl mb-4"></i>
      <p>Authentication failed or session expired.</p>
      <a href="login.html" class="block mt-4 bg-indigo-600 px-6 py-3 rounded-lg text-white">Back to Login</a>
    </div>
  </template>
</main>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyA9sJoZSzbmKJ-7F9jsYVmf7m4cMJ_JUuA",
    authDomain: "captcha-finder.firebaseapp.com",
    projectId: "captcha-finder",
    storageBucket: "captcha-finder.firebasestorage.app",
    messagingSenderId: "268327722037",
    appId: "1:268327722037:web:54ba44e1d4ccc2c734e57c"
  };
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();

  function dashboard() {
    return {
      user: {}, loading: true, error: false,

      init() {
        auth.onAuthStateChanged(async (user) => {
          if (!user) {
            this.error = true;
            this.loading = false;
            setTimeout(() => window.location.href = 'login.html', 2500);
            return;
          }

          const token = await user.getIdToken();
          localStorage.setItem('firebase_user', JSON.stringify({
            uid: user.uid,
            email: user.email,
            token
          }));
          this.user = { email: user.email };
          this.loading = false;
          this.$nextTick(() => this.loadChart());
        });
      },

      logout() {
        auth.signOut().then(() => {
          localStorage.removeItem('firebase_user');
          window.location.href = 'login.html';
        });
      },

      loadChart() {
        const ctx = document.getElementById('chart');
        new Chart(ctx, {
          type: 'line',
          data: {
            labels: ['Mon','Tue','Wed','Thu','Fri','Sat','Sun'],
            datasets: [{
              label: 'Solves',
              data: [12, 19, 7, 15, 23, 18, 24],
              borderColor: '#a78bfa',
              backgroundColor: 'rgba(167,139,250,0.2)',
              fill: true,
              tension: 0.4
            }]
          },
          options: { plugins: { legend: { display: false } } }
        });
      }
    }
  }
</script>
</body>
</html>
